"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var r=arguments[t];if(null!=r)for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e});var rcp_processing=!1;function rcp_get_recaptchav3_token(e){return new Promise(function(t,r){"1"===rcp_script_options.recaptcha_enabled&&"3"===rcp_script_options.recaptcha_version?grecaptcha.ready(function(){grecaptcha.execute(jQuery("#rcp_recaptcha").data("sitekey"),{action:"register"}).then(function(r){jQuery(e).find('input[name="g-recaptcha-response"]').val(r),t()})}):t()})}function rcp_validate_registration_form(e){let t=jQuery;return new Promise(function(r,a){t.post(rcp_script_options.ajaxurl,e.serialize()+"&action=rcp_process_register_form&rcp_ajax=true&validate_only=true",function(i){t(".rcp-submit-ajax",e).remove(),t(".rcp_message.error",e).remove(),i.success?(t("body").trigger("rcp_registration_form_validated",[e,i.data]),r(i.data)):a(i.data)}).success(function(e){}).done(function(e){}).fail(function(e){console.log(e),a(Error(e))}).always(function(e){})})}function rcp_process_registration_form(e){let t=jQuery;return rcp_processing=!0,new Promise(function(r,a){t.post(rcp_script_options.ajaxurl,e.serialize()+"&action=rcp_process_register_form&rcp_ajax=true",function(e){e.success?r(e.data):a(e.data)}).success(function(e){}).done(function(e){}).fail(function(e){console.log(e)}).always(function(e){})})}function rcp_regenerate_registration_nonce(e,t){let r=jQuery;return rcp_processing=!0,new Promise(function(a,i){r.ajax({type:"post",dataType:"json",url:rcp_script_options.ajaxurl,data:{action:"rcp_generate_registration_nonce"},success:function(r){r.success?(t.nonce=r.data,e.find('input[name="rcp_register_nonce"]').val(t.nonce),a(t)):i(t)}})})}function rcp_submit_registration_form(e,t){rcp_processing=!0,e.submit()}function rcp_handle_registration_errors(e,t){let r=jQuery;void 0===t&&(t=r("#rcp_registration_form")),void 0===e.errors&&(e.errors='<div class="rcp_message error" role="list"><p class="rcp_error" role="listitem">'+rcp_script_options.error_occurred+"</p></div>"),t.find("#rcp_submit").val(rcp_script_options.register).before(e.errors),t.find('input[name="rcp_register_nonce"]').val(e.nonce),t.unblock(),rcp_processing=!1}function rcp_get_gateway(){let e,t=jQuery;return t("#rcp_payment_gateways").length>0?(e=t("#rcp_payment_gateways select option:selected")).length<1&&(e=t('input[name="rcp_gateway"]:checked')):e=t('input[name="rcp_gateway"]'),e}function rcp_get_registration_form_state(){let e=jQuery,t=e("#rcp_subscription_levels input:checked");return t.length||(t=e("#rcp_registration_form").find("input[name=rcp_level]")),{membership_level:t.val(),is_free:0==t.attr("rel"),lifetime:"forever"===t.data("duration"),level_has_trial:-1!==rcp_script_options.trial_levels.indexOf(t.val()),discount_code:e("#rcp_discount_code").val(),gateway:rcp_get_gateway().val(),gateway_data:rcp_get_gateway(),auto_renew:e("#rcp_auto_renew").prop("checked")}}function rcp_validate_registration_state(e,t){e||(e=rcp_get_registration_form_state());let r=jQuery,a=r("#rcp_registration_form");a.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}});let i=a.serialize()+"&action=rcp_validate_registration_state&rcp_ajax=true&rcp_level="+e.membership_level+"&lifetime="+e.lifetime+"&level_has_trial="+e.level_has_trial+"&is_free="+e.is_free+"&discount_code="+e.discount_code+"&rcp_gateway="+e.gateway+"&rcp_auto_renew="+(!0===e.auto_renew||"")+"&event_type="+t+"&registration_type="+r("#rcp-registration-type").val()+"&membership_id="+r("#rcp-membership-id").val()+"&rcp_registration_payment_id="+r("#rcp-payment-id").val();r.ajax({type:"post",dataType:"json",url:rcp_script_options.ajaxurl,data:i,success:function(e){e.success?(r(".rcp_gateway_"+e.data.gateway+"_fields").length&&e.data.show_gateway_fields||(r("#rcp_gateway_extra_fields").remove(),1==e.data.show_gateway_fields&&e.data.gateway_fields&&(r(".rcp_gateway_fields").length?r('<div class="rcp_gateway_'+e.data.gateway+'_fields" id="rcp_gateway_extra_fields">'+e.data.gateway_fields+"</div>").insertAfter(".rcp_gateway_fields"):r('<div class="rcp_gateway_'+e.data.gateway+'_fields" id="rcp_gateway_extra_fields">'+e.data.gateway_fields+"</div>").insertAfter(".rcp_gateways_fieldset"),r("body").trigger("rcp_gateway_loaded",e.data.gateway))),rcp_prepare_registration_fields(e.data)):console.log(e),r("#rcp_registration_form").unblock()}})}function rcp_prepare_registration_fields(e){let t=jQuery;if(e.recurring_available?t("#rcp_auto_renew_wrap").show():(t("#rcp_auto_renew_wrap").hide(),t("#rcp_auto_renew_wrap input").prop("checked",!1)),e.level_has_trial&&e.trial_eligible&&(t("#rcp_auto_renew_wrap").hide(),t("#rcp_auto_renew_wrap input").prop("checked",!0)),e.initial_total>0||e.recurring_total>0?t(".rcp_gateway_fields").show():t(".rcp_gateway_fields").hide(),e.show_gateway_fields?t("#rcp_gateway_extra_fields").show():t("#rcp_gateway_extra_fields").remove(),t(".rcp_discount_amount").remove(),t(".rcp_discount_valid, .rcp_discount_invalid").hide(),e.discount_code){e.discount_valid?(t(".rcp_discount_valid").show(),t("#rcp_discount_code_wrap label").append('<span class="rcp_discount_amount"> - '+e.discount_amount+"</span>"),e.full_discount?t(".rcp_gateway_fields").addClass("rcp_discounted_100"):t(".rcp_gateway_fields").removeClass("rcp_discounted_100")):(t(".rcp_discount_invalid").show(),t(".rcp_gateway_fields").removeClass("rcp_discounted_100"));let r={valid:e.discount_valid,full:e.full_discount,amount:e.discount_amount};t("body").trigger("rcp_discount_applied",[r])}t(".rcp_registration_total").html(e.total_details_html)}function rcp_validate_recaptcha(e){jQuery("#rcp_registration_form #rcp_submit").prop("disabled",!1)}jQuery(document).ready(function(e){rcp_validate_registration_state(),e("#rcp-membership-renew-upgrade-toggle").on("click",function(t){t.preventDefault(),e("#rcp-membership-renew-upgrade-choice").toggle()}),e("#rcp_payment_gateways select, #rcp_payment_gateways input").change(function(){e("body").trigger("rcp_gateway_change",{gateway:rcp_get_gateway().val()})}),e(".rcp_level").change(function(){e("body").trigger("rcp_level_change",{subscription_level:e("#rcp_subscription_levels input:checked").val()})}),e("#rcp_apply_discount").on("click",function(t){t.preventDefault(),e("body").trigger("rcp_discount_change",{discount_code:e("#rcp_discount_code").val()})}),e("#rcp_auto_renew").on("change",function(){e("body").trigger("rcp_auto_renew_change",{auto_renew:e(this).prop("checked")})}),e("body").on("rcp_discount_change rcp_level_change rcp_gateway_change rcp_auto_renew_change",function(e,t){rcp_validate_registration_state(Object.assign({},rcp_get_registration_form_state(),t),e.type)}),"1"===rcp_script_options.recaptcha_enabled&&"3"!==rcp_script_options.recaptcha_version&&jQuery("#rcp_registration_form #rcp_submit").prop("disabled",!0),e(document).on("click","#rcp_registration_form #rcp_submit",function(t){t.preventDefault();var r=document.getElementById("rcp_registration_form"),a=e("#rcp_registration_form");if(("function"!=typeof r.checkValidity||!1!==r.checkValidity())&&(a.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),e("#rcp_submit",a).val(rcp_script_options.pleasewait),!rcp_processing)){rcp_processing=!0;var i=(window.rcpRegistrationChecks||[]).map(function(e){return e(a)});Promise.all(i).then(function(){return rcp_get_recaptchav3_token(a)}).then(function(){return rcp_validate_registration_form(a)}).then(function(e){return rcp_process_registration_form(a)}).then(function(e){return rcp_regenerate_registration_nonce(a,e)}).then(function(t){let r=a.find('input[name="rcp_registration_payment_id"]');r.length?r.val(t.payment_id):a.append('<input type="hidden" name="rcp_registration_payment_id" value="'+t.payment_id+'"/>'),e("body").trigger("rcp_register_form_submission",[t,a.attr("id")]);let i=!1;t.gateway.supports&&-1!==t.gateway.supports.indexOf("gateway-submits-form")&&(i=!0),0===t.total&&0===t.recurring_total||!i?rcp_submit_registration_form(a,t):e("body").trigger("rcp_registration_form_processed",[a,t])}).catch(function(e){console.trace("Registration Error",e),rcp_regenerate_registration_nonce(a,e).then(function(e){rcp_handle_registration_errors(e,a)}).catch(function(t){rcp_handle_registration_errors(e,a)})})}})});var rcp_validating_discount=!1,rcp_validating_gateway=!1,rcp_validating_level=!1,rcp_calculating_total=!1;function rcp_validate_form(e){rcp_validate_registration_state()}function rcp_validate_subscription_level(){rcp_validating_level||(rcp_validating_level=!0,rcp_validate_registration_state(),rcp_validating_level=!1)}function rcp_validate_gateways(){rcp_validating_gateway||(rcp_validating_gateway=!0,rcp_validate_registration_state(),rcp_validating_gateway=!1)}function rcp_validate_discount(){rcp_validating_discount||(rcp_validating_discount=!0,rcp_validate_registration_state(),rcp_validating_discount=!1)}function rcp_calc_total(){rcp_calculating_total||(rcp_calculating_total=!0,rcp_validate_registration_state(),rcp_calculating_total=!1)}
